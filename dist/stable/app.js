"use strict";class se{constructor(n,i,t){this.initData=n,this.baseUrl=i,this.manifest=t}initializeWorkspace(){}getUrl(n){return`${this.baseUrl}/${n}`}getMouseCoords(){return this.initData.api.getMouseCoords()}getSelectedBlocks(n){return this.initData.api.getSelectedBlocks(n)}showContextMenuWithBack(n){return this.initData.api.showContextMenuWithBack(n)}registerMenu(n){return this.initData.api.registerMenu(n)}registerItem(n){return this.initData.api.registerItem(n)}createMenu(n,i,t){return this.initData.api.createMenu(n,i,t)}getExtensionVersion(){return this.initData.version}}const Y=new Map;let J;function le(e){J=e,e.pluginManager&&ce(e.pluginManager)}function ce(e){q({baseUrl:e.baseUrl,manifest:{id:"plugin-manager",loadAsModule:e.loadAsModule||!1,main:e.main}})}function q(e){var n;try{const i=new se(J,e.baseUrl,e.manifest);Y.set(e.manifest.id,i);const t=document.createElement("script");t.setAttribute("type",e.manifest.loadAsModule?"module":"text/javascript"),t.setAttribute("src",i.getUrl(e.manifest.main)),t.addEventListener("load",function(){i.initializeWorkspace()}),document.body.appendChild(t)}catch(i){BF2042Portal.Shared.logError(`Failed to load plugin '${((n=e.manifest)==null?void 0:n.name)||e.manifest.id}''`,i)}}function ue(){for(const e of Y.values())e.initializeWorkspace()}function pe(e){const n=Y.get(e);if(!n)throw`Plugin with id ${e} not found!`;return n}const de={initializeWorkspace:ue,getPlugin:pe,loadPlugin:q};function ge(e,n){const i={};return i.Events=e.Events,i.getMainWorkspace=function(){return e.getMainWorkspace()},i.getTranslation=function(t){const o=t.split(".");let r=n.Msg.Msg[o[0]];for(let s=1;s<o.length;s++)r=r[o[s]];return r},i.Blocks={getSelected:function(){return e.getSelected()},getAllClasses:function(){return Object.keys(e.Blocks).map(t=>({key:t,value:e.Blocks[t]}))},getAllInstances:function(){return i.getMainWorkspace().getAllBlocks(!1).map(t=>({key:t.id,value:t}))}},i.ContextMenu={ScopeType:{BLOCK:e.ContextMenuRegistry.ScopeType.BLOCK,WORKSPACE:e.ContextMenuRegistry.ScopeType.WORKSPACE},show:function(t,o,r){e.ContextMenu.show(t,o,r)},getOptionsForWorkspace:function(t){return e.ContextMenuRegistry.registry.getContextMenuOptions(i.ContextMenu.ScopeType.WORKSPACE,{workspace:t})},getOptionsForBlock:function(t){return e.ContextMenuRegistry.registry.getContextMenuOptions(i.ContextMenu.ScopeType.BLOCK,{block:t})},getAllItems:function(){return[...e.ContextMenuRegistry.registry.registry_].map(t=>({key:t[0],value:t[1]}))},unregisterItem:function(t){e.ContextMenuRegistry.registry.unregister(t)},registerItem:function(t){e.ContextMenuRegistry.registry.register(t)}},i.Xml={createElement:e.utils.xml.createElement,mouseToSvg:e.browserEvents.mouseToSvg,workspaceToDom:e.Xml.workspaceToDom,textToDom:e.Xml.textToDom,domToWorkspace:e.Xml.domToWorkspace,domToVariables:e.Xml.domToVariables,domToText:e.Xml.domToText,blockToXml:function(t){const o=e.Xml.blockToDomWithXY(t,!0);return e.Xml.deleteNext(o),e.Xml.domToText(o).replace('xmlns="https://developers.google.com/blockly/xml"',"")}},i}const a=ge(_Blockly,Blockly),R={menus:{},items:{}},w={x:0,y:0},P=[];let v;const b=[],U=[],M=[];let K=!1;const W=new Map;function me(){const e="Не удалось скопировать в буфер обмена!";function n(){return"enabled"}async function i(t){try{const o=k(t),r=Z(o);if(!r){alert(e);return}await BF2042Portal.Shared.copyTextToClipboard(r)}catch(o){BF2042Portal.Shared.logError(e,o),alert(e)}}return{id:"copyToClipboard",displayText:"Скопировать в буфер обмена",scopeType:a.ContextMenu.ScopeType.BLOCK,weight:100,preconditionFn:n,callback:i}}function fe(){const e="Не удалось вставить из буфера обмена!";function n(){return"enabled"}async function i(){try{const t=await BF2042Portal.Shared.pasteTextFromClipboard();ee(t)||alert(e)}catch(t){BF2042Portal.Shared.logError(e,t),alert(e)}}return{id:"pasteFromClipboard",displayText:"Вставить из буфера обмена",scopeType:a.ContextMenu.ScopeType.WORKSPACE,weight:100,preconditionFn:n,callback:i}}function ye(){function e(t){const o=t.block.getCommentIcon()?"Удалить":"Добавить",r=k(t);return r.length===1?`${o} комментарий`:`${o} комментарий (${r.length} блоков)`}function n(){return"enabled"}function i(t){const o=t.block.getCommentIcon()?null:"",r=k(t);for(let s=0;s<r.length;s++)r[s].setCommentText(o)}return{id:"toggleComments",displayText:e,scopeType:a.ContextMenu.ScopeType.BLOCK,weight:100,preconditionFn:n,callback:i}}function he(){function e(t){const o=t.block.getInputsInline()?"Вертикально":"Горизонтально",r=k(t);return r.length===1?`Показать входы ${o}`:`Показать входы ${o} (${r.length} блоков)`}function n(){return"enabled"}function i(t){const o=!t.block.getInputsInline(),r=k(t);for(let s=0;s<r.length;s++)r[s].setInputsInline(o)}return{id:"toggleInputs",displayText:e,scopeType:a.ContextMenu.ScopeType.BLOCK,weight:100,preconditionFn:n,callback:i}}function ke(){function e(t){const o=t.block.isCollapsed()?"Развернуть":"Свернуть",r=k(t);return r.length===1?`${o} блок`:`${o} ${r.length} блоков`}function n(){return"enabled"}function i(t){const o=!t.block.isCollapsed(),r=k(t);for(let s=0;s<r.length;s++)r[s].setCollapsed(o)}return{id:"toggleCollapse",displayText:e,scopeType:a.ContextMenu.ScopeType.BLOCK,weight:100,preconditionFn:n,callback:i}}function xe(){function e(t){const o=k(t);return o?o.length===1?"Свернуть блок":`Свернуть ${o.length} блоков`:"Свернуть все блоки"}function n(){return"enabled"}function i(t){const o=k(t);if(o)for(let r=0;r<o.length;r++)o[r].setCollapsed(!0);else{const r=a.getMainWorkspace();for(const s of r.getAllBlocks(!1))s.setCollapsed(!0)}}return{id:"collapseAllBlocks",displayText:e,scopeType:a.ContextMenu.ScopeType.WORKSPACE,weight:100,preconditionFn:n,callback:i}}function be(){function e(t){const o=k(t);return o?o.length===1?"Развернуть блок":`Развернуть ${o.length} блоков`:"Развернуть все блоки"}function n(){return"enabled"}function i(t){const o=k(t);if(o)for(let r=0;r<o.length;r++)o[r].setCollapsed(!1);else{const r=a.getMainWorkspace();for(const s of r.getAllBlocks(!1))s.setCollapsed(!1)}}return{id:"expandAllBlocks",displayText:e,scopeType:a.ContextMenu.ScopeType.WORKSPACE,weight:100,preconditionFn:n,callback:i}}function Te(){function e(i){return i.block.type==="modBlock"&&a.getMainWorkspace().getBlocksByType("modBlock",!1).length>1?"enabled":"hidden"}function n(i){i.block.dispose(!1,!1)}return{id:"deleteModBlock",displayText:"Удалить MOD блок",scopeType:a.ContextMenu.ScopeType.BLOCK,weight:100,preconditionFn:e,callback:n}}function Ce(){const e="https://docs.bfportal.gg/blocks";function n(){return"enabled"}function i(){window.open(e,"bf2042_documentation")}return{id:"openDocumentation",displayText:"Открыть документацию",scopeType:a.ContextMenu.ScopeType.WORKSPACE,weight:100,preconditionFn:n,callback:i}}function Se(){function e(i){return i.block.type==="subroutineInstanceBlock"?"enabled":"hidden"}function n(i){const t=i.block.getFieldValue("SUBROUTINE_NAME"),o=a.getMainWorkspace().getBlocksByType("subroutineBlock",!1).filter(r=>r.getFieldValue("SUBROUTINE_NAME")===t);o.length>0&&a.getMainWorkspace().centerOnBlock(o[0].id)}return{id:"jumpToSubRoutine",displayText:"Перейти к подпрограмме",scopeType:a.ContextMenu.ScopeType.BLOCK,weight:100,preconditionFn:e,callback:n}}function Be(){function e(){return"enabled"}function n(){document.querySelector("app-root").classList.toggle("distraction-free"),a.getMainWorkspace().resize()}return{id:"toggleDistractionFreeMode",displayText:"Переключить режим без отвлекающих элементов",scopeType:a.ContextMenu.ScopeType.WORKSPACE,weight:100,preconditionFn:e,callback:n}}function Me(){function e(){return"enabled"}function n(){document.querySelector("app-root").classList.toggle("hide-toolbox"),a.getMainWorkspace().resize()}return{id:"toggleToolbox",displayText:"Переключить панель инструментов",scopeType:a.ContextMenu.ScopeType.WORKSPACE,weight:100,preconditionFn:e,callback:n}}function we(){return H("exportBlocksWorkspace",a.ContextMenu.ScopeType.WORKSPACE)}function Ee(){return H("exportBlocksBlock",a.ContextMenu.ScopeType.BLOCK)}function H(e,n){function i(){return"enabled"}function t(l){const d=[{text:"XML",enabled:!0,callback:()=>o(l)},{text:"SVG",enabled:!0,callback:()=>r(l)},{text:"PNG",enabled:!0,callback:()=>s(l)}];BF2042Portal.Shared.isCopyBlobToClipboardSupported()&&d.push({text:"PNG (Буфер обмена)",enabled:!0,callback:()=>m(l)}),L(d)}async function o(l){const d=k(l),p=Z(d);if(!p){alert("Не удалось экспортировать XML!");return}const C=`data:application/xml;charset=utf-8,${encodeURIComponent(p)}`;y(C,"workspace.xml")}async function r(l){const d=k(l),p=await u(d,!1);y(p.svgDataURL,"screenshot.svg")}async function s(l){try{const d=k(l),p=await u(d,!0),C=await c(p,1,"png");y(C,"screenshot.png")}catch(d){BF2042Portal.Shared.logError("Не удалось экспортировать PNG (загрузка)",d),alert("Не удалось экспортировать PNG (загрузка)!")}}async function m(l){try{const d=k(l),p=await u(d,!0),C=await c(p,1,"blob");await BF2042Portal.Shared.copyBlobToClipboard(C),alert("Готово!")}catch(d){BF2042Portal.Shared.logError("Не удалось экспортировать PNG (буфер обмена)",d),alert("Не удалось экспортировать PNG (буфер обмена)!")}}async function u(l,d){const p=a.getMainWorkspace();let C,A,E,x;if(l&&l.length>0){let f,S,T,N;for(let F=0;F<l.length;F++){const I=l[F],B=I.getRelativeToSurfaceXY();(!f||B.x<f)&&(f=B.x),(!S||B.y<S)&&(S=B.y),(!T||B.x+I.width>T)&&(T=B.x+I.width),(!N||B.y+I.height>N)&&(N=B.y+I.height)}C=f,A=S,E=T-f,x=N-S}else{const f=p.getBlocksBoundingBox();C=f.left,A=f.top,E=f.right-C,x=f.bottom-A}const O=p.getCanvas().cloneNode(!0);O.removeAttribute("transform");const h=document.createElementNS("http://www.w3.org/2000/svg","svg");h.setAttribute("xmlns","http://www.w3.org/2000/svg"),h.appendChild(O),h.setAttribute("viewBox",`${C} ${A} ${E} ${x}`),h.setAttribute("class",`blocklySvg ${p.options.renderer||"geras"}-renderer ${p.getTheme?p.getTheme().name+"-theme":""}`),h.setAttribute("width",E.toString()),h.setAttribute("height",x.toString()),h.setAttribute("style","background-color: transparent");const oe=[].slice.call(document.head.querySelectorAll("style")).filter(function(f){return/\.blocklySvg/.test(f.innerText)||f.id.indexOf("blockly-")===0}).map(function(f){return f.innerText}).join(""),z=document.createElement("style");z.innerHTML=oe,h.insertBefore(z,h.firstChild);let X=new XMLSerializer().serializeToString(h).replace(/&nbsp/g,"&#160");if(d){const f=[...X.matchAll(/xlink:href="(.*?)"/g)];for(const S of f){const T=S[1];if(!(T.startsWith("data:")||W.has(T)))try{const N=await new Promise(async(F,I)=>{try{const re=await(await fetch("https://portal.battlefield.com"+T)).blob(),G=new FileReader;G.onload=ae=>{F(ae.target.result)},G.readAsDataURL(re)}catch{I()}});W.set(T,N)}catch{W.set(T,T)}}}X=X.replace(/xlink:href="(.*?)"/g,function(f,S){return`xlink:href="${W.has(S)?W.get(S):S}"`});const ie=`data:image/svg+xml,${encodeURIComponent(X)}`;return{width:E,height:x,svgDataURL:ie}}async function c(l,d,p){return new Promise((A,E)=>{const x=document.createElement("canvas"),j=x.getContext("2d"),O=new Image;x.width=l.width*d,x.height=l.height*d,(x.width>16384||x.height>16384)&&E("The resulting image would be too large to handle for your browser. Please select less blocks or reduce the scale."),O.onload=function(){j.drawImage(O,0,0,l.width,l.height,0,0,x.width,x.height);try{if(p==="png"){const h=x.toDataURL("image/png");A(h)}else if(p==="blob")x.toBlob(function(h){A(h)});else throw"Unknown type"}catch(h){E(`Не удалось конвертировать SVG: ${h}`)}},O.src=l.svgDataURL})}function y(l,d){const p=document.createElement("a");p.setAttribute("href",l),p.setAttribute("download",d),p.style.display="none",document.body.appendChild(p),p.click(),document.body.removeChild(p)}return{id:e,displayText:"Экспорт блоков >",scopeType:n,weight:100,preconditionFn:i,callback:t}}function ve(){function e(){return"enabled"}function n(){const i=document.createElement("input");i.setAttribute("type","file"),i.setAttribute("accept",".xml,.json"),i.style.display="none",i.addEventListener("change",function(){if(!i.files||i.files.length===0)return;const t=new FileReader;t.onload=function(o){confirm("Вы хотите удалить все существующие блоки перед импортом?")&&a.getMainWorkspace().clear();try{const r=i.files[0].name.split(".").pop().toLowerCase();if(r==="json"){const s=JSON.parse(o.target.result);We(s)||alert("Не удалось импортировать рабочую область из JSON!")}else r==="xml"&&(ee(o.target.result)||alert("Не удалось импортировать рабочую область из XML!"))}catch{alert("Не удалось импортировать рабочую область!")}},t.readAsText(i.files[0])}),document.body.appendChild(i),i.click(),document.body.removeChild(i)}return{id:"importBlocksFromFile",displayText:"Импорт блоков из файла",scopeType:a.ContextMenu.ScopeType.WORKSPACE,weight:100,preconditionFn:e,callback:n}}function Ae(){function e(){return"enabled"}function n(){const t=[];for(let o=0;o<U.length;o++){const r=U[o];t.push({text:r.displayName,enabled:!0,callback:function(){const s=[];for(let m=0;m<r.contents.length;m++){const u=r.contents[m];let c;switch(u.type){case"mod":c="⚫";break;case"rule":case"controlAction":c="🟣";break;case"condition":c="🔵";break;case"value":case"literal":c="🟢";break;case"action":c="🟡";break;default:c="⚪";break}s.push({text:`${c} ${u.displayName}`,enabled:!0,callback:function(){const y=a.getMainWorkspace().newBlock(u.internalName);y.initSvg(),y.render(),y.moveTo(w)}})}L(s.sort(i))}})}L(t.sort(i))}function i(t,o){return t.text>o.text?1:-1}return{id:"addBlock",displayText:"Добавить блок >",scopeType:a.ContextMenu.ScopeType.WORKSPACE,weight:100,preconditionFn:e,callback:n}}function Ne(){return Q("separatorWorkspace",a.ContextMenu.ScopeType.WORKSPACE)}function Ie(){return Q("separatorBlock",a.ContextMenu.ScopeType.BLOCK)}function Q(e,n){return{id:e,displayText:"---",scopeType:n,weight:100,preconditionFn:()=>"disabled",callback:()=>{}}}function Re(){return V("optionsWorkspace","Опции",a.ContextMenu.ScopeType.WORKSPACE)}function Oe(){return V("optionsBlock","Опции",a.ContextMenu.ScopeType.BLOCK)}function V(e,n,i){function t(){return"enabled"}function o(r){const s=R.menus[e],m=[];for(let u=0;u<s.options.length;u++){const c=Fe(s.options[u],i,r);c&&m.push(c)}L(m)}return{id:e,displayText:`${n} >`,scopeType:i,weight:100,preconditionFn:t,callback:o,options:[]}}function Fe(e,n,i){let t;if(e.startsWith("items.")?t=R.items[e.substring(6)]:e.startsWith("menus.")&&(t=R.menus[e.substring(6)]),!(!t||t.scopeType!==n))return{text:typeof t.displayText=="string"?t.displayText:t.displayText(i),enabled:t.preconditionFn(i)==="enabled",callback:()=>t.callback(i)}}function $(e){R.menus[e.id]=e}function g(e){R.items[e.id]=e}function Z(e){const n=a.getMainWorkspace();try{let i="";if(e&&e.length>0){for(let t=0;t<e.length;t++)i+=a.Xml.blockToXml(e[t]);return i}else{const t=a.Xml.workspaceToDom(n,!0),o=t.querySelector("variables");return o&&t.removeChild(o),a.Xml.domToText(t).replace('<xml xmlns="https://developers.google.com/blockly/xml">',"").replace("</xml>","")}}catch(i){BF2042Portal.Shared.logError("Не удалось сохранить рабочую область!",i)}}function We(e){const n=a.getMainWorkspace();try{const i=a.Xml.textToDom(e.variables?e.variables:"<xml />");return a.Xml.domToVariables(i,n),a.Xml.domToWorkspace(a.Xml.textToDom(e.mainWorkspace),n),!0}catch(i){BF2042Portal.Shared.logError("Не удалось загрузить рабочую область из JSON!",i)}return!1}function ee(e){try{if(!e||(e=e.trim(),!e.startsWith("<block")))return!1;const n=`<xml xmlns="https://developers.google.com/blockly/xml">${e.trim()}</xml>`,i=a.Xml.textToDom(n),t=i.querySelectorAll("block[type='variableReferenceBlock']"),o=[];t.forEach(u=>{const c=u.querySelector("field[name='OBJECTTYPE']").textContent,y=u.querySelector("field[name='VAR']").textContent;c&&y&&!o.find(l=>l.objectType===c&&l.variableName===y)&&o.push({objectType:c,variableName:y})});const r=document.createElement("variables");o.forEach(u=>{const c=document.createElement("variable");c.setAttribute("type",u.objectType),c.innerText=u.variableName,r.appendChild(c)}),a.Xml.domToVariables(r,a.getMainWorkspace());let s,m;for(let u=0;u<i.childNodes.length;u++){const c=i.childNodes[u],y=parseInt(c.getAttribute("x")),l=parseInt(c.getAttribute("y"));(!s||y<s)&&(s=y),(!m||l<m)&&(m=l)}for(let u=0;u<i.childNodes.length;u++){const c=i.childNodes[u],y=parseInt(c.getAttribute("x")),l=parseInt(c.getAttribute("y"));y===s?c.setAttribute("x",w.x.toString()):c.setAttribute("x",(y-s+w.x).toString()),l===m?c.setAttribute("y",w.y.toString()):c.setAttribute("y",(l-m+w.y).toString())}return a.Xml.domToWorkspace(i,a.getMainWorkspace()),!0}catch(n){BF2042Portal.Shared.logError("Не удалось загрузить рабочую область из XML!",n)}return!1}function D(e){return e.split(" ").map(n=>n.charAt(0).toUpperCase()+n.substring(1).toLowerCase()).join(" ")}function k(e){let n;return M.length>0&&(n=M),!n&&(a.Blocks.getSelected()||e!==void 0&&e.block)&&(n=[a.Blocks.getSelected()||e.block]),n}function Pe(){return{x:w.x,y:w.y}}function L(e){P.push(v.options),a.ContextMenu.show(v.e,[].concat({text:"< Назад",enabled:!0,callback:()=>{const n=P.splice(P.length-1,1);a.ContextMenu.show(v.e,n[0],v.rtl)}},{text:"---",enabled:!1,callback:()=>{}}).concat(e),v.rtl)}function Le(){Xe(),De(),Ue(),$e(BF2042Portal.Startup.getBlockDefinitions()),_e(),Ke(),le({api:{getSelectedBlocks:k,getMouseCoords:Pe,showContextMenuWithBack:L,registerMenu:$,registerItem:g,createMenu:V},version:BF2042Portal.Startup.getVersion(),pluginManager:BF2042Portal.Startup.getManifest().pluginManager})}function Xe(){const e=document.createElement("style");e.setAttribute("type","text/css"),e.innerHTML=`
        /*.blocklyMenu {
            overflow-y: hidden !important;
        }*/

        .distraction-free ea-network-nav, .distraction-free ea-local-nav-advanced {
            display: none;
        }

        .distraction-free > div.app {
            padding-top: 0;
        }

        .distraction-free .editor-container {
            grid-template-columns: 0 !important;
        }

        .hide-toolbox .blocklyToolboxDiv {
            display: none !important;
        }
    `,document.head.appendChild(e)}function De(){const e=a.getMainWorkspace(),n=Object.getPrototypeOf(e),i=n.showContextMenu;n.showContextMenu=function(s){P.length=0,v={e:s,options:a.ContextMenu.getOptionsForWorkspace(this),rtl:this.RTL},_(s),i.apply(this,arguments)};const t=Object.getPrototypeOf(e.getTopBlocks(!1)[0]),o=t.showContextMenu;t.showContextMenu=function(s){return P.length=0,v={e:s,options:a.ContextMenu.getOptionsForBlock(this),rtl:this.RTL},_(s),o.apply(this,arguments)};const r=_Blockly.ContextMenu.show;_Blockly.ContextMenu.show=function(s,m,u){v={e:s,options:m,rtl:u},_(s),r.apply(this,arguments)}}function Ue(){function e(i){Ve(),Ye(i),setTimeout(function(){BF2042Portal.Plugins.initializeWorkspace()},0)}const n=_Blockly.inject;_Blockly.inject=function(){const i=n.apply(this,arguments);return e(i),i},e(a.getMainWorkspace())}function _e(){document.addEventListener("keydown",function(e){K=e.shiftKey}),document.addEventListener("keyup",function(e){K=e.shiftKey})}function Ke(){for(const o of a.ContextMenu.getAllItems())g(o.value);a.ContextMenu.unregisterItem("cleanWorkspace"),a.ContextMenu.unregisterItem("workspaceDelete");const e=Re();e.weight=-99,e.options=["items.workspaceDelete","items.separatorWorkspace","items.collapseAllBlocks","items.expandAllBlocks","items.openDocumentation","items.toggleDistractionFreeMode","items.toggleToolbox","items.separatorWorkspace","items.exportBlocksWorkspace","items.importBlocksFromFile"];const n=Oe();n.weight=-99,n.options=["items.deleteModBlock","items.separatorBlock","items.toggleComments","items.toggleInputs","items.toggleCollapse","items.separatorBlock","items.exportBlocksBlock"],$(e),$(n),g(me()),g(fe()),g(ye()),g(he()),g(ke()),g(xe()),g(be()),g(Te()),g(Ce()),g(Se()),g(Be()),g(Me()),g(we()),g(Ee()),g(ve()),g(Ne()),g(Ie());const i=Ae();i.weight=-100,g(i),["items.addBlock","menus.optionsWorkspace","menus.optionsBlock","items.cleanWorkspace","items.jumpToSubRoutine","items.copyToClipboard","items.pasteFromClipboard"].forEach(function(o){let r;if(o.startsWith("items.")){const s=o.substring(6);r=R.items[s]}else if(o.startsWith("menus.")){const s=o.substring(6);r=R.menus[s]}r&&a.ContextMenu.registerItem(r)})}function $e(e){b.push({type:"mod",category:t("RULES"),internalName:"modBlock",displayName:D(a.getTranslation("PYRITE_MOD"))}),b.push({type:"rule",category:t("RULES"),internalName:"ruleBlock",displayName:D(a.getTranslation("PYRITE_RULE"))}),b.push({type:"condition",category:t("RULES"),internalName:"conditionBlock",displayName:D(a.getTranslation("PYRITE_CONDITION"))}),b.push({type:"literal",category:t("LITERALS"),internalName:"Boolean",displayName:a.getTranslation("PYRITE_TYPE_BOOLEAN")}),b.push({type:"literal",category:t("LITERALS"),internalName:"Number",displayName:a.getTranslation("PYRITE_TYPE_NUMBER")}),b.push({type:"literal",category:t("LITERALS"),internalName:"Text",displayName:a.getTranslation("PYRITE_TYPE_STRING")}),b.push({type:"value",category:t("ARRAYS"),internalName:"ArrayContains",displayName:a.getTranslation("PYRITE_CONVENIENCE_ARRAYCONTAINS")}),b.push({type:"value",category:t("ARRAYS"),internalName:"IndexOfArrayValue",displayName:a.getTranslation("PYRITE_CONVENIENCE_INDEXOFARRAYVALUE")}),b.push({type:"value",category:t("ARRAYS"),internalName:"RemoveFromArray",displayName:a.getTranslation("PYRITE_CONVENIENCE_REMOVEFROMARRAY")}),b.push({type:"value",category:t("SUBROUTINES"),internalName:"subroutineArgumentBlock",displayName:"GetSubroutineArgument"}),b.push({type:"action",category:t("CONVENIENCE"),internalName:"actionComment",displayName:"Comment"});const n=[...new Set(e.selectionLists.map(o=>o.listType+"Item"))],i=["GetArgument"];for(let o=0;o<e.values.length;o++){const r=e.values[o];if(!r.category){if(i.includes(r.name))continue;r.name==="GetVariable"?r.category="VARIABLES":n.includes(r.name)?r.category="SELECTION_LISTS":BF2042Portal.Shared.logError("No category found for value-block",r)}b.push({type:"value",category:t(r.category),internalName:r.name,displayName:a.getTranslation(r.displayNameSID)||r.name})}for(let o=0;o<e.actions.length;o++){const r=e.actions[o];r.category||(r.name==="SetVariable"?r.category="VARIABLES":BF2042Portal.Shared.logError("No category found for action-block",r)),b.push({type:"action",category:t(r.category),internalName:r.name,displayName:a.getTranslation(r.displayNameSID)||r.name})}for(let o=0;o<e.controlActions.length;o++){const r=e.controlActions[o];b.push({type:"controlAction",category:t("CONTROL_ACTIONS"),internalName:r.name,displayName:a.getTranslation(r.displayNameSID)||r.name})}b.forEach(o=>{const r=U.find(s=>s.internalName===(o.category||"Other"));r?r.contents.push(o):U.push({internalName:o.category||"Other",displayName:D(o.category||"Other"),contents:[o]})});function t(o){if(o)return a.getTranslation("PYRITE_TOOLBOX_"+o.replace(" ","_").toUpperCase())}}function Ye(e){let n,i,t;e.addChangeListener(function(o){if(o.type===a.Events.CLICK||o.type===a.Events.SELECTED)if(K){if(!o.blockId)return;const r=e.getBlockById(o.blockId),s=M.indexOf(r);s<0?(M.push(r),r.setHighlighted(!0)):(M.splice(s,1),r.setHighlighted(!1))}else M.length>0&&(M.forEach(r=>{r.setHighlighted(!1)}),M.length=0);else if(o.type===a.Events.BLOCK_DRAG&&!o.isStart)t=o.blockId;else if(o.type===a.Events.MOVE&&o.newCoordinate&&o.oldCoordinate&&t){const r=t;t=void 0,n=o.newCoordinate.x-o.oldCoordinate.x,i=o.newCoordinate.y-o.oldCoordinate.y;for(let s=0;s<M.length;s++){const m=M[s];m.id!==r&&m.moveBy(n,i)}}})}function _(e){const n=a.getMainWorkspace();if(!n)return;const i=a.Xml.mouseToSvg(e,n.getParentSvg(),n.getInverseScreenCTM()),t=n.getMetricsManager().getAbsoluteMetrics();i.x-=t.left,i.y-=t.top,i.x-=n.scrollX,i.y-=n.scrollY,i.x/=n.scale,i.y/=n.scale,w.x=i.x,w.y=i.y}function Ve(){function e(n){if(!n.saveExtraState||!n.loadExtraState||n.mutationToDom&&n.domToMutation)return;n.mutationToDom=function(){const t=a.Xml.createElement("mutation");return t.setAttribute("portal-extensions-state",JSON.stringify(this.saveExtraState())),t};const i=n.domToMutation;n.domToMutation=function(t){const o=t.getAttribute("portal-extensions-state");o?this.loadExtraState(JSON.parse(o)):i&&i.apply(this,arguments)}}for(const n of a.Blocks.getAllClasses())e(n.value);for(const n of a.Blocks.getAllInstances())e(n.value)}const je={};let te=He,ne=e=>{};function ze(){navigator.clipboard.readText===void 0&&(te=Qe,window.addEventListener("bf2042-portal-extensions-paste",async function(e){ne(e.detail)}))}async function Ge(e){return await navigator.clipboard.writeText(e)}async function Je(e){return await navigator.clipboard.write([new ClipboardItem({[e.type]:e})])}async function qe(){return await te()}async function He(){return await navigator.clipboard.readText()}async function Qe(){return new Promise((e,n)=>{ne=t=>{t?e(t):n()};const i=new Event("bf2042-portal-extensions-paste");document.dispatchEvent(i)})}function Ze(){return window.ClipboardItem!==void 0}function et(e,n){console.log(`[ERROR] ${e}`,n)}function tt(e){const n=localStorage.getItem(e);try{if(typeof n=="string")return JSON.parse(n)}catch{}return{}}function nt(e,n){localStorage.setItem(e,JSON.stringify(n))}const ot={copyTextToClipboard:Ge,copyBlobToClipboard:Je,pasteTextFromClipboard:qe,isCopyBlobToClipboardSupported:Ze,loadFromLocalStorage:tt,saveToLocalStorage:nt,logError:et};BF2042Portal.Shared=ot;BF2042Portal.Plugins=de;BF2042Portal.Extensions=je;ze();Le();
//# sourceMappingURL=app.js.map
